# Atende Ai - Arquitetura do Projeto

## ğŸ—ï¸ VisÃ£o Geral da Arquitetura

O **Atende Ai** Ã© um sistema de atendimento virtual multi-empresa com arquitetura distribuÃ­da baseada em microserviÃ§os. O projeto utiliza uma arquitetura moderna com separaÃ§Ã£o clara entre frontend, backend e serviÃ§os externos.

### **Arquitetura Principal:**
- **Frontend:** React 18 com Vite (SPA)
- **Backend:** FastAPI (Python) com SQLAlchemy
- **Banco de Dados:** PostgreSQL
- **Cache:** Redis
- **ContainerizaÃ§Ã£o:** Docker + Docker Compose
- **IntegraÃ§Ãµes:** OpenAI, Twilio, Google Sheets, Chatwoot

## ğŸ“ Estrutura de DiretÃ³rios

### **Backend (`backend/`)**
```
backend/
â”œâ”€â”€ main.py                 # AplicaÃ§Ã£o FastAPI principal
â”œâ”€â”€ config.py              # ConfiguraÃ§Ãµes e variÃ¡veis de ambiente
â”œâ”€â”€ models.py              # Modelos SQLAlchemy e Pydantic
â”œâ”€â”€ services.py            # LÃ³gica de negÃ³cio principal
â”œâ”€â”€ requirements.txt       # DependÃªncias Python
â”œâ”€â”€ integrations/          # IntegraÃ§Ãµes com APIs externas
â”‚   â”œâ”€â”€ openai_service.py
â”‚   â”œâ”€â”€ twilio_service.py
â”‚   â”œâ”€â”€ google_sheets_service.py
â”‚   â”œâ”€â”€ google_calendar_service.py
â”‚   â””â”€â”€ chatwoot_service.py
â””â”€â”€ services/              # ServiÃ§os internos
    â”œâ”€â”€ message_buffer.py  # Sistema de buffer de mensagens
    â””â”€â”€ services.py        # ServiÃ§os de processamento
```

### **Frontend (`frontend/`)**
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # Componentes React
â”‚   â”‚   â”œâ”€â”€ AdminDashboard.jsx
â”‚   â”‚   â”œâ”€â”€ EmpresaDashboard.jsx
â”‚   â”‚   â”œâ”€â”€ BufferStatus.jsx
â”‚   â”‚   â”œâ”€â”€ LogsViewer.jsx
â”‚   â”‚   â”œâ”€â”€ ConversationView.jsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx
â”‚   â”‚   â”œâ”€â”€ Login.jsx
â”‚   â”‚   â””â”€â”€ Usuarios.jsx
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.js        # Cliente HTTP para backend
â”‚   â”œâ”€â”€ App.jsx           # Componente principal
â”‚   â””â”€â”€ main.jsx          # Ponto de entrada
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.js
```

## ğŸ”§ Componentes Principais

### **1. Backend FastAPI ([main.py](mdc:backend/main.py))**
- **Framework:** FastAPI com autenticaÃ§Ã£o JWT
- **AutenticaÃ§Ã£o:** OAuth2PasswordBearer com tokens JWT
- **Rotas principais:**
  - `/api/admin/*` - Endpoints administrativos
  - `/webhook/{empresa_slug}` - Webhooks do Twilio
  - `/api/logs` - Sistema de logs
  - `/api/conversation/*` - HistÃ³rico de conversas

### **2. Modelos de Dados ([models.py](mdc:backend/models.py))**
- **Empresa:** ConfiguraÃ§Ãµes por empresa (slug, nome, integraÃ§Ãµes)
- **Mensagem:** HistÃ³rico de mensagens por cliente
- **Usuario:** Sistema de usuÃ¡rios com roles
- **Log:** Sistema de logs estruturado

### **3. Sistema de Buffer ([message_buffer.py](mdc:backend/services/message_buffer.py))**
- **Agrupamento:** Mensagens em buffer de 10 segundos
- **Processamento:** Texto e Ã¡udio separadamente
- **OtimizaÃ§Ã£o:** Reduz spam de respostas

### **4. IntegraÃ§Ãµes Externas**
- **OpenAI:** GPT-4o + Whisper para processamento de linguagem natural
- **Twilio:** WhatsApp Business API para envio/recebimento
- **Google Sheets:** GestÃ£o de reservas e dados
- **Chatwoot:** CRM e gestÃ£o de contatos
- **Google Calendar:** Agendamento de reuniÃµes

## ğŸ—„ï¸ Banco de Dados

### **PostgreSQL (via Docker)**
- **Tabelas principais:**
  - `empresas` - ConfiguraÃ§Ãµes por empresa
  - `messages` - HistÃ³rico de mensagens
  - `usuarios` - Sistema de usuÃ¡rios
  - `logs` - Logs estruturados

### **Redis (Cache)**
- **Contexto de conversa:** ManutenÃ§Ã£o de estado
- **Buffer temporÃ¡rio:** Mensagens em processamento
- **SessÃµes:** Dados temporÃ¡rios

## ğŸš€ Deploy e Infraestrutura

### **Docker Compose ([docker-compose.yml](mdc:docker-compose.yml))**
- **PostgreSQL:** Banco de dados principal
- **Redis:** Cache e sessÃµes
- **Backend:** API FastAPI
- **Frontend:** React com Nginx

### **ConfiguraÃ§Ãµes de Ambiente**
- **Desenvolvimento:** `.env` local
- **ProduÃ§Ã£o:** VariÃ¡veis de ambiente no Docker
- **Empresas:** ConfiguraÃ§Ãµes por empresa em JSON

## ğŸ” SeguranÃ§a e AutenticaÃ§Ã£o

### **Sistema de UsuÃ¡rios**
- **SuperusuÃ¡rios:** Acesso total ao sistema
- **UsuÃ¡rios por empresa:** Acesso limitado Ã  empresa especÃ­fica
- **JWT Tokens:** AutenticaÃ§Ã£o stateless

### **ProteÃ§Ã£o de Rotas**
- **Admin routes:** Requer superusuÃ¡rio
- **Empresa routes:** Requer usuÃ¡rio da empresa
- **Webhooks:** AutenticaÃ§Ã£o por empresa

## ğŸ“Š Painel Administrativo

### **Dashboards**
- **Dashboard Geral:** MÃ©tricas macro do sistema
- **Dashboard por Empresa:** MÃ©tricas especÃ­ficas
- **Status do Buffer:** Monitoramento em tempo real
- **Logs e Erros:** Sistema de observabilidade

### **Funcionalidades**
- **GestÃ£o de Empresas:** CRUD completo
- **GestÃ£o de UsuÃ¡rios:** Sistema de roles
- **Monitoramento:** Buffer status e logs
- **Conversas:** VisualizaÃ§Ã£o de histÃ³rico

## ğŸ”„ Fluxo de Dados

### **1. Recebimento de Mensagem**
```
Twilio Webhook â†’ FastAPI â†’ Buffer â†’ OpenAI â†’ Processamento â†’ Resposta
```

### **2. Processamento Inteligente**
```
Buffer (10s) â†’ Agrupamento â†’ OpenAI (GPT-4o) â†’ IntegraÃ§Ãµes â†’ Twilio
```

### **3. Sistema de Logs**
```
AÃ§Ãµes â†’ Logs estruturados â†’ PostgreSQL â†’ Painel Admin
```

## ğŸ› ï¸ Tecnologias e DependÃªncias

### **Backend**
- **FastAPI:** Framework web moderno
- **SQLAlchemy:** ORM para PostgreSQL
- **Redis:** Cache e sessÃµes
- **JWT:** AutenticaÃ§Ã£o stateless
- **Pydantic:** ValidaÃ§Ã£o de dados

### **Frontend**
- **React 18:** Framework frontend
- **Vite:** Build tool moderna
- **React Router:** NavegaÃ§Ã£o SPA
- **Axios:** Cliente HTTP

### **DevOps**
- **Docker:** ContainerizaÃ§Ã£o
- **Docker Compose:** OrquestraÃ§Ã£o local
- **Nginx:** Proxy reverso (produÃ§Ã£o)

## ğŸ“ˆ Escalabilidade

### **Arquitetura Multi-empresa**
- **Isolamento:** ConfiguraÃ§Ãµes por empresa
- **Slugs Ãºnicos:** IdentificaÃ§Ã£o de empresas
- **Prompts personalizados:** IA especÃ­fica por negÃ³cio

### **Performance**
- **Processamento assÃ­ncrono:** asyncio
- **Buffer inteligente:** Reduz chamadas de API
- **Cache Redis:** Contexto de conversa
- **Logs estruturados:** Observabilidade

## ğŸ” Pontos de Entrada Principais

### **Desenvolvimento**
- **Backend:** `uvicorn main:app --reload --port 8000`
- **Frontend:** `npm run dev`
- **Docker:** `docker-compose up`

### **ProduÃ§Ã£o**
- **Docker Compose:** `docker-compose.prod.yml`
- **Nginx:** Proxy reverso para frontend
- **SSL:** Certificados automÃ¡ticos

## ğŸ“ ConvenÃ§Ãµes de CÃ³digo

### **Backend (Python)**
- **FastAPI:** Decorators para rotas
- **SQLAlchemy:** Models com relationships
- **Pydantic:** ValidaÃ§Ã£o de dados
- **Async/await:** Processamento assÃ­ncrono

### **Frontend (React)**
- **Componentes funcionais:** Hooks modernos
- **CSS Modules:** EstilizaÃ§Ã£o modular
- **Props drilling:** ComunicaÃ§Ã£o entre componentes
- **Context API:** Estado global quando necessÃ¡rio

## ğŸš¨ Monitoramento e Logs

### **Sistema de Logs**
- **NÃ­veis:** INFO, WARNING, ERROR
- **Estrutura:** JSON com metadados
- **Empresa:** Filtros por empresa
- **Tempo:** Timestamps precisos

### **MÃ©tricas**
- **Admin:** MÃ©tricas macro do sistema
- **Empresa:** MÃ©tricas especÃ­ficas
- **Buffer:** Status em tempo real
- **Erros:** Monitoramento de falhas

---

**Desenvolvido com â¤ï¸ pela TinyTeams**
description:
globs:
alwaysApply: false
---
